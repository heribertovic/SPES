
<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.0/css/all.css">
<title>Servicios PubliZoom</title>
<style>
  /* Estilos básicos para visualización */
    body { margin: 0;
        font-size: 16px;
        color: #393839;
        font-family: Arial, sans-serif; }

    .divservycar { display: flex;
        justify-content: space-between;
        background-color: aqua;
        height: 4000px;
        flex-wrap: wrap;
        padding: 0 }



    /* PLANES Y SERVICIOS */
  .sectservicio {
    border: 1px solid #ccc;
    box-sizing: border-box;
    margin-bottom: 10px;
    width: 288px;
    cursor: pointer;
    background-color: #f9f9f9; }

    .tituloarmatuplan { font-weight: 800;
        text-align: center; }

    .sectservicio:hover { cursor: text; }

    .tituloservicio { font-size: 18px;
        background-color: #393839;
        text-align: center;
        width: 100%;
        color: white;
        align-items: center;
        padding-top: 9px;
        padding-bottom: 9px;
        margin-top: 0;
        margin-bottom: 0; }

    .parrservicio { font-style: oblique;
        margin: 3px 6px; }

    .btnagragar { cursor: pointer;
        background-color: #83004C;
        color: white;
        font-size: 14px;
        border-color: #83004C;
        border-radius: 0 9px;
        padding: 7px 12px;
        display: block;
        margin: 0 auto 9px auto;
        font-weight: 800; }

    .btnagragar:hover {  background-color: #51002f; }

    .artservicio { display: flex;
        justify-content: space-between;
        flex-wrap: wrap; } 
        
    @media screen and (min-width: 1525px) and (max-width: 3840px) {
         .artservicio { width: 1080px; } }

    @media screen and (min-width: 1000px) and (max-width: 1525px) {
         .artservicio { width: 600px;; } }

    @media screen and (min-width: 0px) and (max-width: 1000px) {
        .artservicio {  width: 288px;
            display: inline; } }



    /* CARRITO */
    .divcar { width: 288px;
        right: 0;
        bottom: 1%;
        background-color: #83004C;
        position: fixed; }

    .titulocar { text-align: center;
        color: white; }

    /* ¡IMPORTANTE! Este div ya no tiene el ID "carrito" */
    .interiorcar { border: 2px solid #83004C;
        font-size: 14px;
        background-color: white; }

    .ulcardatos {   background-color: #393839;
        color: white;
        display: flex;
        justify-content: space-between;
        margin: 0;
        padding: 0 9px;
        padding-left: 18px;
        font-weight: bold;
        align-items: center;
        text-align: center; }

    .licardatos { list-style: none; }

    /* Este UL ahora tiene el ID "itemsCarrito" */
    .ulcaritems { padding-left: 3px;
        padding-right: 3px;
        text-align: left; }

    .textoredess { text-align: center;
        font-weight: bold;
        margin-bottom: 0;
        font-size: 16px; }

    .mensaje-alerta {
        color: red;
        font-weight: bold;
        text-align: center;
        margin-top: 5px;
        margin-bottom: 5px;
    }

  /* Nuevo estilo para el botón X de eliminar */
    .licaritem { list-style: none;
        display: flex; /* Añadido para habilitar flexbox para el espaciado */
        align-items: center; /* Alinea los ítems verticalmente */ }

    .licaritem .btn-eliminar-item {
        background-color: #83004C; /* Morado de PubliZoom */
        color: white;
        border: 1px solid #83004C; /* Borde del mismo color */
        cursor: pointer;
        margin-right: 5px; /* Margen para separar de la cantidad */
        padding: 1px 4px; /* Ajusta el padding para el tamaño de la X */
        font-weight: 800;
        font-size: 10px; /* Tamaño del botón X vuelto a como estaba en tu código original */
        border-radius: 3px; /* Bordes ligeramente redondeados */ }

    .licaritem .btn-eliminar-item:hover {
        background-color: #51002f; /* Un morado más oscuro al pasar el mouse */ }

    .licaritem input[type="number"] { /* Estilo para el input de cantidad */
        width: 36px;
        margin-right: 20px; /* Separación de la descripción */ }
    
    /* INCLUIR REDES CARRITO */
    .ulredess { display: flex;
        justify-content: space-around;
        margin: 0;
        padding: 0;
        font-size: 24px; }

    .liredess { list-style: none; }

    /* Clase para alinear el precio a la derecha */

    .preciostotales { display: flex;
        justify-content: space-around;
        font-size: 16px;
        font-weight: 600; }

    .preciototal-car {
        margin-left: auto; /* Esto empuja el elemento a la derecha dentro de un contenedor flex */
        text-align: right; }

    .limimppago { display: flex;
        justify-content: space-around;
        text-align: center;
        margin-bottom: 9px;
        padding: 0 9px;
        font-size: 14px; }

    .vaciar-carrito { font-weight: bold;
        font-style: italic;
        text-align: right;
        padding: 0 0 3px 3px;
        text-decoration: underline;
        background-color: white;
        color: #83004C;
        border: none;
        cursor: pointer; }

    .gestpago { background-color: rgb(0, 111, 223);
        color: white;
        padding: 3px 15px;
        border-radius: 0 9px;
        text-decoration: none;
        font-weight: 900; }

    .gestpago.disabled {
        background-color: #cccccc;
        cursor: not-allowed;
        opacity: 0.7;
    }

</style>

</head>

<body>

    <div class="divservycar">

    <div class="divservicio">
        <h2 class="tituloarmatuplan">ARMA O ELIGE TU PLAN</h2>
        <Article class="artservicio" id="listaServicios">

            <section class="sectservicio" data-nombre="Publicación de Imagen." data-precio="450" data-minimo="1">
                <h3 class="tituloservicio">Publicación de Imagen.</h3>
                <p class="parrservicio">Creamos un diseño para ser posteado en redes sociales con recursos entregados por usted.</p>
                <ul class="parrservicio">
                    <li>Un diseño al mes.</li>
                </ul>
                <p class="precioservicio"><b>Precio: RD$450.00</b></p>
                <button class="btnagragar" onclick="agregarAlCarrito(this)">Agregar al Carrito</button>
            </section>

            <section class="sectservicio" data-nombre="Publicación Video." data-precio="725" data-minimo="1">
                <h3 class="tituloservicio">Publicación Video.</h3>
                <p class="parrservicio">Editamos y animamos recursos para postear audiovisuales en redes sociales.</p>
                <ul class="parrservicio">
                    <li>Una edición al mes.</li>
                </ul>
                <p class="precioservicio"><b>Precio: RD$725.00</b></p>
                <button class="btnagragar" onclick="agregarAlCarrito(this)">Agregar al Carrito</button>
            </section>

            <section class="sectservicio" data-nombre="Voz Comercial." data-precio="60" data-minimo="30">
                <h3 class="tituloservicio">Voz Comercial.</h3>
                <p class="parrservicio"> Sirve para comunicar mejor las ideas.</p>
                <ul class="parrservicio">
                    <li>Escritura del guión.</li>
                    <li>Grabar y cancelar de ruidos.</li>
                    <li>RD$60*Seg. 30 al mes.</li>
                </ul>
                <p class="precioservicio"><b>Precio: RD$60.00</b></p>
                <button class="btnagragar" onclick="agregarAlCarrito(this)">Agregar al Carrito</button>
            </section>

            <section class="sectservicio" data-nombre="Fotografía de Producto." data-precio="450" data-minimo="1">
                <h3 class="tituloservicio">Fotografía de Producto.</h3>
                <p class="parrservicio"> Fotografías de productos para crear audiovisuales.</p>
                <ul class="parrservicio">
                    <li>Captura en RAW.</li>
                    <li>Mosaico para su selección.</li>
                    <li>Retoque y entrega en editable.</li>
                </ul>
                <p class="precioservicio"><b>Precio: RD$450.00</b></p>
                <button class="btnagragar" onclick="agregarAlCarrito(this)">Agregar al Carrito</button>
            </section>

            <section class="sectservicio" data-nombre="Grabación de Audiovisual." data-precio="650" data-minimo="1">
                <h3 class="tituloservicio">Grabación de Audiovisuales.</h3>
                <p class="parrservicio"> Realizamos la Fotografía de Producto para publicaciones.</p>
                <ul class="parrservicio">
                    <li>Filmación en 1080p.</li>
                    <li>Corte inicio y fin.</li>
                    <li>Entrega del video vía drive.</li>
                </ul>
                <p class="precioservicio"><b>Precio: RD$650.00</b></p>
                <button class="btnagragar" onclick="agregarAlCarrito(this)">Agregar al Carrito</button>
            </section>

            <section class="sectservicio" data-nombre="Asesorias presenciales." data-precio="750" data-minimo="1">
                <h3 class="tituloservicio">Asesorias presenciales.</h3>
                <p class="parrservicio">Encuentro personal para evaluar sus necesidades, sus infraestructuas.</p>
                <ul class="parrservicio">
                    <li>2 horas.</li>
                    <li>Presentación de propuestra.</li>
                </ul>
                <p class="precioservicio"><b>Precio: RD$750.00</b></p>
                <button class="btnagragar" onclick="agregarAlCarrito(this)">Agregar al Carrito</button>
            </section>

            <section class="sectservicio" data-nombre="Crear Redes Sociales." data-precio="7500" data-minimo="1">
                <h3 class="tituloservicio">Crear Redes Sociales.</h3>
                <p class="parrservicio">Crear y organizar los perfiles, entregando los accesos a los encargados para iniciar las publicaciones.</p>
                <ul class="parrservicio">
                    <li>Gmail</li>
                    <li>Instagram</li>
                    <li>Facebook</li>
                    <li>Tiktok</li>
                    <li>X (twitter)</li>
                </ul>
                <p class="precioservicio"><b>Precio: RD$7,500.00</b></p>
                <button class="btnagragar" onclick="agregarAlCarrito(this)">Agregar al Carrito</button>
            </section>

            <section class="sectservicio" data-nombre="Desarrolo de Marca." data-precio="12500" data-minimo="1">
                <h3 class="tituloservicio">Desarrolo de Marca.</h3>
                <p class="parrservicio">Crear la imagen corporativa desarrollando la idea con 5 mockup distintos.</p>
                <ul class="parrservicio">
                    <li>Crear identidad corporativa.</li>
                    <li>Clasificar necesidad: Isotipo, Logotipo, Imagotipo, Isologo.</li>
                    <li>Entrega de archivos editables.</li>
                </ul>
                <p class="precioservicio"><b>Precio: RD$12,500.00</b></p>
                <button class="btnagragar" onclick="agregarAlCarrito(this)">Agregar al Carrito</button>
            </section>


        </Article>
    </div>

    <div class="divcar">
        <h2 class="titulocar">CARRO DE COMPRAS</h2>
        <div class="interiorcar" id="carritoContenedor"> 
            <ul class="ulcardatos">
                <li class="licardatos">Cantidad <br> al Mes</li>
                <li class="licardatos">Descripción</li>
                <li class="licardatos">Precio</li>
            </ul>
            <p class="textoredess" id="mensajeCarritoVacio">No hay servicios en el carrito.</p>
            <ul class="ulcaritems" id="itemsCarrito"> 
            </ul>
            <p class="textoredess">¿Cuáles Redes Sociales quieres?</p>
            <ul class="ulredess" id="listaRedesSociales">

                <label for="fa-facebook">
                    <li class="liredess">
                        <i class="fab fa-facebook">‌<input id="fa-facebook" type="checkbox" data-red="facebook"></i>
                    </li>
                </label>

                <label for="fa-instagram">
                    <li class="liredess">
                        <i class="fab fa-instagram"><input id="fa-instagram" type="checkbox" data-red="instagram"></i>
                    </li>
                </label>

                <label for="fa-tiktok">
                    <li class="liredess">
                        <i class="fa-brands fa-tiktok">‌<input id="fa-tiktok" type="checkbox" data-red="tiktok"></i>
                    </li>
                </label>

                <label for="fa-x-twitter">
                    <li class="liredess">
                        <i class="fa-brands fa-x-twitter">‌‌<input id="fa-x-twitter" type="checkbox" data-red="x-twitter"></i>
                    </li>
                </label>

                <!-- <label for="fa-whatsapp">
                    <li class="liredess">
                        <i class="fa-brands fa-whatsapp">‌‌<input id="fa-whatsapp" type="checkbox" data-red="whatsapp"></i>
                    </li>
                </label> -->

            </ul>

            <p class="mensaje-alerta" id="alertaRedesSociales" style="display: none;">
                *Debes seleccionar al menos una red social para servicios de publicación.
            </p>

            <div class="preciostotales">
                <p>Total: RD$<span id="totalCarritoRD">0.00</span></p>
                <p>Total: $<span id="totalCarritoUSD">0.00</span></p>
            </div>

            <div class="limimppago">
                <button class="vaciar-carrito" onclick="vaciarCarrito()">Vaciar Carrito</button>
                <a class="gestpago" id="botonComprar" href="https://www.paypal.com/ncp/payment/VV5LW97A2BWYY">COMPRAR</a>
            </div>

        </div>
    </div>

    </div>

<script>
  let carrito = []; // Array para almacenar los servicios en el carrito
  let exchangeRateUSDToDOP = 0; // Variable para almacenar la tasa de cambio

  // Servicios que son de "Publicación" y se ven afectados por la lógica de redes sociales (20% de descuento)
  const SERVICIOS_PUBLICACION = [
    "Publicación de Imagen.",
    "Publicación Video."
  ];

  // Servicios que aplican descuento por CANTIDAD en cascada (5%)
  const SERVICIOS_CON_DESCUENTO_POR_CANTIDAD = [
    "Publicación de Imagen.",
    "Publicación Video.",
    "Fotografía de Producto.",
    "Grabación de Audiovisuales."
  ];

  // Función auxiliar para verificar si un servicio es de publicación
  function esServicioDePublicacion(nombreServicio) {
    return SERVICIOS_PUBLICACION.includes(nombreServicio);
  }

  // Función auxiliar para verificar si un servicio aplica descuento por cantidad
  function aplicaDescuentoPorCantidad(nombreServicio) {
    return SERVICIOS_CON_DESCUENTO_POR_CANTIDAD.includes(nombreServicio);
  }

  // Función para obtener la tasa de cambio de USD a DOP
  async function fetchExchangeRate() {
    try {
      const response = await fetch('https://cdn.jsdelivr.net/npm/@fawazahmed0/currency-api@latest/v1/currencies/usd.json');
      if (!response.ok) {
        throw new Error(`HTTP error! status: ${response.status}`);
      }
      const data = await response.json();
      if (data && data.usd && data.usd.dop) {
        exchangeRateUSDToDOP = data.usd.dop;
        console.log('Tasa de cambio USD a DOP obtenida:', exchangeRateUSDToDOP);
      } else {
        console.error('No se pudo encontrar la tasa de cambio DOP en la respuesta de la API.');
        exchangeRateUSDToDOP = 59.20; // Valor de respaldo si falla la API
      }
    } catch (error) {
      console.error('Error al obtener la tasa de cambio:', error);
      exchangeRateUSDToDOP = 59.20; // Valor de respaldo en caso de error de red
    }
    // Llama a actualizarCarrito DESPUÉS de que la tasa de cambio se haya intentado obtener
    actualizarCarrito(); 
  }

  function agregarAlCarrito(boton) {
    const servicioDiv = boton.closest('.sectservicio');
    const nombre = servicioDiv.dataset.nombre;
    // Asegurarse de que el precio sea un número válido, incluso si es 0
    const precio = parseFloat(servicioDiv.dataset.precio) || 0; 
    const minimo = parseInt(servicioDiv.dataset.minimo) || 1; 

    const servicioExistente = carrito.find(item => item.nombre === nombre);

    if (servicioExistente) {
      servicioExistente.cantidad++;
    } else {
      const servicio = { nombre, precio, cantidad: minimo, minimo: minimo }; 
      carrito.push(servicio);
    }
    actualizarCarrito();
  }

  function actualizarCarrito() {
    const itemsCarritoUl = document.getElementById('itemsCarrito'); // ¡CORREGIDO! Asegúrate de que este ID sea el de la UL
    const totalCarritoRDSpan = document.getElementById('totalCarritoRD');
    const totalCarritoUSDSpan = document.getElementById('totalCarritoUSD');
    const mensajeCarritoVacio = document.getElementById('mensajeCarritoVacio');
    const alertaRedesSociales = document.getElementById('alertaRedesSociales');
    const botonComprar = document.getElementById('botonComprar');

    let totalDOP = 0;
    let hayServiciosPublicacion = false;
    let redesSeleccionadasCount = 0;
    const checkboxesRedes = document.querySelectorAll('#listaRedesSociales input[type="checkbox"]');

    // Contar redes sociales seleccionadas
    checkboxesRedes.forEach(checkbox => {
        if (checkbox.checked) {
            redesSeleccionadasCount++;
        }
    });

    itemsCarritoUl.innerHTML = ''; // Limpia la lista actual del carrito

    if (carrito.length === 0) {
      mensajeCarritoVacio.style.display = 'block'; // Muestra el mensaje si el carrito está vacío
      alertaRedesSociales.style.display = 'none'; // Oculta la alerta de redes
      botonComprar.classList.remove('disabled'); // Habilita el botón de comprar
      botonComprar.style.pointerEvents = 'auto'; // Asegura que se pueda hacer clic
    } else {
      mensajeCarritoVacio.style.display = 'none'; // Oculta el mensaje si hay ítems

      carrito.forEach((item, index) => {
        let precioBaseUnitarioEfectivo = item.precio; // Este será el precio de 1 unidad, afectado por redes sociales si aplica

        // Paso 1: Aplicar descuento por redes sociales si el servicio es de publicación
        if (esServicioDePublicacion(item.nombre)) {
            let costoPorRedesParaEsteServicio = 0;
            if (redesSeleccionadasCount > 0) {
                let costoRedAnterior = item.precio; // Comienza con el precio base del servicio
                for (let i = 0; i < redesSeleccionadasCount; i++) {
                    costoPorRedesParaEsteServicio += costoRedAnterior;
                    costoRedAnterior *= 0.80; // Aplica 20% de descuento en cascada para cada red adicional
                }
            } else {
                // Si es un servicio de publicación pero no hay redes seleccionadas, el costo es 0 por esta parte
                costoPorRedesParaEsteServicio = 0; 
            }
            precioBaseUnitarioEfectivo = costoPorRedesParaEsteServicio; // Este es ahora el precio unitario del servicio ajustado por redes
        }

        // Paso 2: Aplicar descuento por cantidad en cascada al precio unitario ya ajustado (si aplica)
        let costoTotalItemPorCantidad = 0;
        if (aplicaDescuentoPorCantidad(item.nombre)) {
            let costoUnitarioActualParaCantidad = precioBaseUnitarioEfectivo; // Comienza con el precio unitario efectivo (ya ajustado por redes)
            for (let i = 0; i < item.cantidad; i++) {
                if (i === 0) { // La primera unidad paga el precio unitario efectivo
                    costoTotalItemPorCantidad += costoUnitarioActualParaCantidad;
                } else { // Unidades adicionales aplican el 5% de descuento en cascada
                    costoUnitarioActualParaCantidad *= 0.95; // Aplica 5% de descuento (multiplicando por 0.95)
                    costoTotalItemPorCantidad += costoUnitarioActualParaCantidad;
                }
            }
        } else {
            // Si no aplica descuento por cantidad, el costo total es simplemente el precio unitario efectivo por la cantidad
            costoTotalItemPorCantidad = precioBaseUnitarioEfectivo * item.cantidad;
        }

        // Determinar si hay servicios de publicación en el carrito para la alerta
        if (esServicioDePublicacion(item.nombre)) {
            hayServiciosPublicacion = true;
        }

        const li = document.createElement('li'); // Creando el elemento li para el ítem
        li.className = 'licaritem';
        li.innerHTML = `
          <button class="btn-eliminar-item" onclick="eliminarDelCarrito(${index})">X</button>
          <input type="number" min="${item.minimo || 1}" value="${item.cantidad}" 
                 onchange="actualizarCantidad(${index}, this.value)">
          <span>${item.nombre}</span>
          <span class="preciototal-car">RD$${costoTotalItemPorCantidad.toFixed(2)}</span>
        `;
        itemsCarritoUl.appendChild(li);
        totalDOP += costoTotalItemPorCantidad; // Suma al total en Pesos Dominicanos
      });

      // Lógica de validación de redes sociales
      let alertaRedesSocialesActiva = false;
      if (hayServiciosPublicacion && redesSeleccionadasCount === 0) {
          alertaRedesSocialesActiva = true;
          alertaRedesSociales.style.display = 'block'; // Muestra la alerta
          botonComprar.classList.add('disabled'); // Deshabilita el botón
          botonComprar.style.pointerEvents = 'none'; // Impide el clic
      } else {
          alertaRedesSociales.style.display = 'none'; // Oculta la alerta
          botonComprar.classList.remove('disabled'); // Habilita el botón
          botonComprar.style.pointerEvents = 'auto'; // Asegura que se pueda hacer clic
      }
    }

    // Actualizar el total en Pesos Dominicanos
    totalCarritoRDSpan.textContent = totalDOP.toFixed(2);

    // Calcular y actualizar el total en Dólares Estadounidenses solo si la tasa ya fue obtenida
    if (exchangeRateUSDToDOP > 0) {
      const totalUSD = totalDOP / exchangeRateUSDToDOP;
      totalCarritoUSDSpan.textContent = totalUSD.toFixed(2);
    } else {
        totalCarritoUSDSpan.textContent = 'Cargando...';
    }
  }

  function actualizarCantidad(index, nuevaCantidad) {
    nuevaCantidad = parseInt(nuevaCantidad);
    const item = carrito[index];
    const minimo = item.minimo || 1;

    if (isNaN(nuevaCantidad) || nuevaCantidad < minimo) {
      alert(`La cantidad mínima para "${item.nombre}" es ${minimo}.`);
      item.cantidad = minimo;
    } else {
      item.cantidad = nuevaCantidad;
    }
    actualizarCarrito();
  }

  function eliminarDelCarrito(index) {
    carrito.splice(index, 1);
    actualizarCarrito();
  }

  function vaciarCarrito() {
    carrito = []; // Vacía el array del carrito
    // Desmarcar todos los checkboxes de redes sociales al vaciar el carrito
    document.querySelectorAll('#listaRedesSociales input[type="checkbox"]').forEach(checkbox => {
        checkbox.checked = false;
    });
    actualizarCarrito();
  }

  // Inicializar el carrito y obtener la tasa de cambio al cargar la página
  document.addEventListener('DOMContentLoaded', () => {
    fetchExchangeRate(); // Llama a fetchExchangeRate que luego llama a actualizarCarrito
    // Añadir event listeners a los checkboxes de redes sociales
    const checkboxesRedes = document.querySelectorAll('#listaRedesSociales input[type="checkbox"]');
    checkboxesRedes.forEach(checkbox => {
        checkbox.addEventListener('change', actualizarCarrito);
    });
  });
</script>

</body>
</html>


